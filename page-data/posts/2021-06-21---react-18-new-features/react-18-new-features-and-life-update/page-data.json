{
    "componentChunkName": "component---src-templates-post-template-post-template-tsx",
    "path": "/posts/2021-06-21---react-18-new-features/react-18-new-features-and-life-update",
    "result": {"data":{"markdownRemark":{"id":"fac39d3e-7fbb-527a-9fad-0e6ebd6b95aa","html":"<h2 id=\"transition\" style=\"position:relative;\"><a href=\"#transition\" aria-label=\"transition permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Transition</h2>\n<p>Consider typing in an input field that filters a list of data. It needs to store the value of the field in state so that it can filter the data and control the value of that input field.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It update the input value and use the new value to search the list and show the results whenever the user types a character. For large-screen updates, this can cause lag on the page while everything renders, making typing or other interactions feel slow and unresponsive. Even if the list is not too long, the list items themselves may be complex and different on every keystroke, and there may be no clear way to optimize their rendering.</p>\n<p>Conceptually, the issue is that there are two different updates that need to happen. The first update is an urgent update, to change the value of the input field and, potentially, some UI around it. The second is a less urgent update to show the results of the search.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Urgent: Show what was typed</span>\n<span class=\"token function\">setInputValue</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Not urgent: Show the results</span>\n<span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In terms of the concept here, we use <code class=\"language-text\">debounce</code> to handle the search queries and separate the input text from the queries.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token keyword\">const</span> onKeywordChange <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">keyword</span><span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>p<span class=\"token punctuation\">,</span> keyword <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSearch</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">onKeywordChange</span><span class=\"token punctuation\">(</span>rawKeywordInput<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">setRawKeywordInput</span><span class=\"token punctuation\">(</span>rawKeywordInput<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">onKeywordChange</span><span class=\"token punctuation\">(</span>rawKeywordInput<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>rawKeywordInput<span class=\"token punctuation\">,</span> onKeywordChange<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The new startTransition API solves this issue by giving you the ability to mark updates as “transitions”:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> startTransition <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Urgent: Show what was typed</span>\n<span class=\"token function\">setInputValue</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Mark any state updates inside as transitions</span>\n<span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Transition: Show the results</span>\n  <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"automatic-batching-for-fewer-renders\" style=\"position:relative;\"><a href=\"#automatic-batching-for-fewer-renders\" aria-label=\"automatic batching for fewer renders permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Automatic batching for fewer renders</h2>\n<p>Batching is when React groups multiple state updates into a single re-render for better performance.</p>\n<p>For example, if you have two state updates inside of the same click event, React has always batched these into one re-render. If you run the following code, you’ll see that every time you click, React only performs a single render although you set the state twice:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>loadingDisabled<span class=\"token punctuation\">,</span> setLoadingDisabled<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>roomNumber<span class=\"token punctuation\">,</span> setRoomNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>RoomNumber<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>defaultRoomNumber<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clickHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">roomType</span><span class=\"token operator\">:</span> RoomType</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setLoadingDisabled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">disabled</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>disabled<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">setRoomNumber</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">roomNumber</span> <span class=\"token operator\">=></span> roomNumber <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// React would only re-render once in v18</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is great for performance because it avoids unnecessary re-renders.</p>\n<p>React would not batch the updates if you need to fetch data, and then update the state in the <code class=\"language-text\">clickHandler</code> above, and perform two independent updates.</p>\n<p>This is because React used to only batch updates during a browser event (like click), but here we’re updating the state after the event has already been handled (in fetch callback):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>loadingDisabled<span class=\"token punctuation\">,</span> setLoadingDisabled<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>roomNumber<span class=\"token punctuation\">,</span> setRoomNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>RoomNumber<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>defaultRoomNumber<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clickHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">roomType</span><span class=\"token operator\">:</span> RoomType</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">fetchRoomNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLoadingDisabled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">disabled</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>disabled<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Before React 18: Re-render</span>\n    <span class=\"token function\">setRoomNumber</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">roomNumber</span> <span class=\"token operator\">=></span> roomNumber <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Before React 18: Re-render</span>\n    <span class=\"token comment\">// React 18: Re-render once</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Manually re-render interface:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> flushSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>loadingDisabled<span class=\"token punctuation\">,</span> setLoadingDisabled<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>roomNumber<span class=\"token punctuation\">,</span> setRoomNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>RoomNumber<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>defaultRoomNumber<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clickHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">roomType</span><span class=\"token operator\">:</span> RoomType</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">flushSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLoadingDisabled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">disabled</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>disabled<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Re-render</span>\n\n  <span class=\"token function\">flushSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRoomNumber</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">roomNumber</span> <span class=\"token operator\">=></span> roomNumber <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Re-render</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"ssr-support-for-suspense\" style=\"position:relative;\"><a href=\"#ssr-support-for-suspense\" aria-label=\"ssr support for suspense permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSR support for Suspense</h2>\n<p>Basically, it just shortens the time to interactive during the SSR process.</p>\n<h2 id=\"adoption\" style=\"position:relative;\"><a href=\"#adoption\" aria-label=\"adoption permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adoption</h2>\n<p>It is quite easy to upgrade React 18 as no breaking changes.</p>\n<p>Well , that’s great because Next.js would definitely adopt it every soon and I just need to keep an eye on the npm modules and next configs.</p>\n<hr>\n<p>Half year has passed since React 17 is released.</p>\n<p>I’ve stepped into another territory by learning new business, using new technical stack and collaborating with new tools.</p>\n<p>It has been such a pleasure to work with my colleagues as everyone is really humble and proactive.</p>\n<p>There are people love coding and engineering from the bottom of their hearts like I do.</p>\n<p>And I made a timeline calendar from scratch recently.</p>\n<p>It recalls me that my friends said someone would steal and copy my idea once but I’m the only person who has the actual creative sprit.</p>\n<p>Innovation lives with my blood and ready to blossom any time.</p>\n<p>To be humble and kind are much better than to be arrogant and cocky.</p>","fields":{"slug":"/posts/2021-06-21---react-18-new-features/react-18-new-features-and-life-update","tagSlugs":["/tag/frontend/","/tag/life/","/tag/web-development/"]},"frontmatter":{"date":"2021-06-21T12:40:32.169Z","description":"","tags":["Frontend","Life","Web Development"],"title":"React 18 New Features and life update","socialImage":""}}},"pageContext":{"slug":"/posts/2021-06-21---react-18-new-features/react-18-new-features-and-life-update"}},
    "staticQueryHashes": ["251939775","357378587","401334301"]}